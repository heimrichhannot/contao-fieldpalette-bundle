jQuery.noConflict();var FieldPaletteBackend={},UtilsBundle=window.utilsBundle;FieldPaletteBackend.deleteFieldPaletteEntry=function(a,b){return new Request.Contao({url:a.href,followRedirects:!1,onComplete:function(b,c){FieldPaletteBackend.refreshFieldPalette(a.getParent(".fielpalette-wizard").getProperty("id"))}}).get(),!1},FieldPaletteBackend.makeFieldPaletteListSortable=function(b){var c=new Scroller(document.getElement("body"),{onChange:function(b,a){this.element.scrollTo(this.element.getScroll().x,a)}}),a=new Sortables(b,{constrain:!0,opacity:.6,onStart:function(){c.start()},onComplete:function(){c.stop()},handle:".drag-handle"});a.active=!1,a.addEvent("start",function(){a.active=!0}),a.addEvent("complete",function(c){if(a.active){var e,d,b,f=c.getElement(".tl_content_right "+a.options.handle),b=f.get("data-href"),e=f.get("data-id"),d=f.get("data-pid");c.getPrevious("li")?(d=c.getPrevious("li").getChildren(".tl_content_right "+a.options.handle).get("data-id"),b=b.replace(/id=[0-9]*/,"id="+e)+"&act=cut&mode=1&pid="+d,new Request.Contao({url:b,followRedirects:!1}).get()):c.getParent("ul")&&(b=b.replace(/id=[0-9]*/,"id="+e)+"&act=cut&mode=2&pid="+d,new Request.Contao({url:b,followRedirects:!1}).get())}})},FieldPaletteBackend.openModalIframe=function(d){var a=d||{},b=(window.getSize().x-20).toInt(),c=(window.getSize().y-137).toInt();(!a.width||a.width>b)&&(a.width=Math.min(b,900)),(!a.height||a.height>c)&&(a.height=c),new SimpleModal({keyEsc:!1,width:a.width,hideFooter:!0,draggable:!1,overlayOpacity:.5,closeButton:!0,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){FieldPaletteBackend.refreshFieldPalette(d.syncId),document.body.setStyle("overflow","auto")}}).show({title:a.title,contents:'<iframe src="'+a.url+'" width="100%" height="'+a.height+'" frameborder="0" id="fieldPaletteContent"></iframe>'})},FieldPaletteBackend.refreshFieldPalette=function(a){var b=a.replace("ctrl_","");new Request.Contao({onRequest:function(){$(a).getElement(".tl_fielpalette_indicator").show()},onSuccess:function(c,b){if(""!==b.autoSubmit&& void 0!==b.autoSubmit&&"undefinded"!==b.autoSubmit&&null!==b.autoSubmit){Backend.autoSubmit(b.autoSubmit);return}new Element("div",{html:b.content}).getFirst().replaces($(a)),$(a).getElement(".tl_fielpalette_indicator").hide(),FieldPaletteBackend.initDataTable($(a).getElement("table.tl_fieldpalette_wizard")),FieldPaletteBackend.makeFieldPaletteListSortable($(a).getElement("ul.tl_fieldpalette_sortable"))}}).post({action:"refreshFieldPaletteField",field:b,REQUEST_TOKEN:Contao.request_token})},$$("ul.tl_fieldpalette_sortable").each(function(a){FieldPaletteBackend.makeFieldPaletteListSortable(a.id)}),function($){FieldPaletteBackend.initDataTable=function(a){var b=$("html").attr("lang"),c=!1;$(a).hasClass("tl_fieldpalette_sortable")&&(c={selector:".drag-handle"}),($.fn.dataTable.isDataTable(a)?$(a).DataTable():$(a).DataTable({language:DATATABLE_MESSAGES[b]?DATATABLE_MESSAGES[b]:DATATABLE_MESSAGES.en,stateSave:!0,columnDefs:[{searchable:!1,targets:0},{targets:"no-sort",orderable:!1}],rowReorder:c,pagingType:"full_numbers",lengthMenu:[10,25,50,100,500],initComplete:function(){var b=$(a).closest(".tl_fieldpalette_wrapper");b.find("select").addClass("tl_select").css("width","auto"),b.find('input[type="search"], input[type="text"]').addClass("tl_text").css("width","auto")}})).on("row-reorder",function(n,f,l){for(var i=l.triggerRow.data().DT_RowId,d=null,e=0,m=f.length;e<m;e++)if(f[e].node.id==i){d=f[e];break}if(null!==d){var g=$(d.node).find(".drag-handle"),b=g.data("href"),j=g.data("id"),h=g.data("pid");if(0===d.newPosition)b=b.replace(/id=[0-9]*/,"id="+j)+"&act=cut&mode=2&pid="+h,new Request.Contao({url:b,followRedirects:!1}).get();else{var k=$(a).find("#"+i).prev("tr");if(void 0===k)return;h=k.find(c.selector).data("id"),b=b.replace(/id=[0-9]*/,"id="+j)+"&act=cut&mode=1&pid="+h,new Request.Contao({url:b,followRedirects:!1}).get()}}})},$(document).ready(function(){$("table.tl_fieldpalette_wizard").each(function(){FieldPaletteBackend.initDataTable(this)})})}(jQuery)
jQuery.noConflict();var FieldPaletteBackend={deleteFieldPaletteEntry:function(e,t){return new Request.Contao({url:e.href,followRedirects:!1,onComplete:function(t,l){FieldPaletteBackend.refreshFieldPalette(e.getParent(".fielpalette-wizard").getProperty("id"))}}).get(),!1},makeFieldPaletteListSortable:function(e){var t=new Scroller(document.getElement("body"),{onChange:function(e,t){this.element.scrollTo(this.element.getScroll().x,t)}}),l=new Sortables(e,{constrain:!0,opacity:.6,onStart:function(){t.start()},onComplete:function(){t.stop()},handle:".drag-handle"});l.active=!1,l.addEvent("start",function(){l.active=!0}),l.addEvent("complete",function(e){if(l.active){var t=e.getElement(".tl_content_right "+l.options.handle),a=t.get("data-href"),n=t.get("data-id"),i=t.get("data-pid");e.getPrevious("li")?(i=e.getPrevious("li").getChildren(".tl_content_right "+l.options.handle).get("data-id"),a=a.replace(/id=[0-9]*/,"id="+n)+"&act=cut&mode=1&pid="+i,new Request.Contao({url:a,followRedirects:!1}).get()):e.getParent("ul")&&(a=a.replace(/id=[0-9]*/,"id="+n)+"&act=cut&mode=2&pid="+i,new Request.Contao({url:a,followRedirects:!1}).get())}})},openModalIframe:function(e){var t=e||{},l=(window.getSize().x-20).toInt(),a=(window.getSize().y-137).toInt();(!t.width||t.width>l)&&(t.width=Math.min(l,900)),(!t.height||t.height>a)&&(t.height=a);var n=new SimpleModal({keyEsc:!1,width:t.width,hideFooter:!0,draggable:!1,overlayOpacity:.5,closeButton:!0,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){FieldPaletteBackend.refreshFieldPalette(e.syncId),document.body.setStyle("overflow","auto")}});n.show({title:t.title,contents:'<iframe src="'+t.url+'" width="100%" height="'+t.height+'" frameborder="0" id="fieldPaletteContent"></iframe>'}),document.getElementById("fieldPaletteContent").onload=function(){var e=(this.contentDocument.body||this.contentWindow.document.body).getElementById("tl_fieldpalette"),t=(this.contentDocument.body||this.contentWindow.document.body).getElementById("container");if(null!=t&&t.classList.add("fieldpalette-form-container"),null==e)return!1;var l=e.querySelectorAll(".tl_error").length>0,a=e.getAttribute("action");UtilsBundle.getParameterByName("closeModal",a)&&!l?n.hide():(a=UtilsBundle.removeParameterFromUri(a,"closeModal"),e.setAttribute("action",a)),e.getElementById("saveNclose").addEventListener("click",function(){a=UtilsBundle.addParameterToUri(a,"closeModal",1),e.setAttribute("action",a)})}},refreshFieldPalette:function(e){var t=e.replace("ctrl_","");new Request.Contao({onRequest:function(){$(e).getElement(".tl_fielpalette_indicator").show()},onSuccess:function(t,l){new Element("div",{html:l.content}).getFirst().replaces($(e)),$(e).getElement(".tl_fielpalette_indicator").hide(),FieldPaletteBackend.initDataTable($(e).getElement("table.tl_fieldpalette_wizard")),FieldPaletteBackend.makeFieldPaletteListSortable($(e).getElement("ul.tl_fieldpalette_sortable"))}}).post({action:"refreshFieldPaletteField",field:t,REQUEST_TOKEN:Contao.request_token})}};$$("ul.tl_fieldpalette_sortable").each(function(e){FieldPaletteBackend.makeFieldPaletteListSortable(e.id)}),function(e){FieldPaletteBackend.initDataTable=function(t){var l=e("html").attr("lang"),a=!1;e(t).hasClass("tl_fieldpalette_sortable")&&(a={selector:".drag-handle"}),(e.fn.dataTable.isDataTable(t)?e(t).DataTable():e(t).DataTable({language:DATATABLE_MESSAGES[l]?DATATABLE_MESSAGES[l]:DATATABLE_MESSAGES.en,stateSave:!0,columnDefs:[{searchable:!1,targets:0},{targets:"no-sort",orderable:!1}],rowReorder:a,pagingType:"full_numbers",lengthMenu:[10,25,50,100,500],initComplete:function(){var l=e(t).closest(".tl_fieldpalette_wrapper");l.find("select").addClass("tl_select").css("width","auto"),l.find('input[type="search"], input[type="text"]').addClass("tl_text").css("width","auto")}})).on("row-reorder",function(l,n,i){for(var o=i.triggerRow.data().DT_RowId,d=null,r=0,c=n.length;r<c;r++)if(n[r].node.id==o){d=n[r];break}if(null!==d){var s=e(d.node).find(".drag-handle"),u=s.data("href"),f=s.data("id"),h=s.data("pid");if(0===d.newPosition)u=u.replace(/id=[0-9]*/,"id="+f)+"&act=cut&mode=2&pid="+h,new Request.Contao({url:u,followRedirects:!1}).get();else{var g=e(t).find("#"+o).prev("tr");if(void 0===g)return;h=g.find(a.selector).data("id"),u=u.replace(/id=[0-9]*/,"id="+f)+"&act=cut&mode=1&pid="+h,new Request.Contao({url:u,followRedirects:!1}).get()}}})},e(document).ready(function(){e("table.tl_fieldpalette_wizard").each(function(){FieldPaletteBackend.initDataTable(this)})})}(jQuery);
